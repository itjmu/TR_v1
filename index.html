<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞—Å–±–∏—Ö</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
            transition: background 0.3s, color 0.3s;
        }
        #counter {
            font-size: 48px;
            margin: 20px;
        }
        button, select {
            font-size: 24px;
            padding: 10px 20px;
            margin: 5px;
        }
        .dark {
            background: #222;
            color: white;
        }
    </style>
</head>
<body>

    <h1>–¢–∞—Å–±–∏—Ö</h1>
    <div id="user-info"></div>
    <div id="counter">0</div>
    <button id="increment">+1</button>
    <button id="reset">–°–±—Ä–æ—Å</button>

    <br><br>
    <label for="step">–®–∞–≥ —É–≤–µ–ª–∏—á–µ–Ω–∏—è:</label>
    <select id="step">
        <option value="1">+1</option>
        <option value="5">+5</option>
        <option value="10">+10</option>
    </select>

    <br><br>
    <button id="close">–ó–∞–∫—Ä—ã—Ç—å</button>

    <script>
        let count = localStorage.getItem("tasbihCount") || 0;
        let step = localStorage.getItem("tasbihStep") || 1;

        const counter = document.getElementById("counter");
        const incrementBtn = document.getElementById("increment");
        const resetBtn = document.getElementById("reset");
        const stepSelect = document.getElementById("step");
        const closeBtn = document.getElementById("close");
        const userInfo = document.getElementById("user-info");

        counter.textContent = count;
        stepSelect.value = step;

        incrementBtn.addEventListener("click", () => {
            count = parseInt(count) + parseInt(step);
            counter.textContent = count;
            localStorage.setItem("tasbihCount", count);
        });

        resetBtn.addEventListener("click", () => {
            count = 0;
            counter.textContent = count;
            localStorage.setItem("tasbihCount", count);
        });

        stepSelect.addEventListener("change", () => {
            step = stepSelect.value;
            localStorage.setItem("tasbihStep", step);
        });

        closeBtn.addEventListener("click", () => {
            Telegram.WebApp.close();
        });

        // Telegram API
        let tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            let user = tg.initDataUnsafe.user;
            userInfo.innerHTML = `üë§ ${user.first_name} ${user.last_name || ""}`;
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
        function applyTheme() {
            document.body.style.background = tg.themeParams.bg_color || "#fff";
            document.body.style.color = tg.themeParams.text_color || "#000";
        }

        applyTheme();
        tg.onEvent("themeChanged", applyTheme);
    </script>

</body>
</html>