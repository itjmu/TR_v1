<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞—Å–±–∏—Ö-—Å—á—ë—Ç—á–∏–∫</title>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body {
            font-family: 'Arial', sans-serif;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
        }

        /* –°—Ç–∏–ª–∏ –º–µ–Ω—é */
        .menu-btn {
            position: fixed;
            top: 10px;
            left: 10px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1001;
            color: white;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
        }

        .sidebar {
            position: fixed;
            left: -50%;
            top: 0;
            width: 50%;
            height: 50%;
            background: rgba(40, 40, 40, 0.95);
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            transition: 0.3s;
            z-index: 1002;
            color: white;
        }

        .sidebar.active {
            left: 0;
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid #555;
        }

        .menu-items {
            list-style: none;
            padding: 0;
        }

        .menu-items li a {
            display: block;
            padding: 15px 20px;
            text-decoration: none;
            color: #fff;
            transition: background 0.3s;
        }

        .menu-items li a:hover {
            background: rgba(255,255,255,0.1);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 50%;
            height: 50%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 1001;
        }

        /* –°—Ç–∏–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            z-index: 1003;
            color: white;
        }

        .stats-content {
            position: relative;
        }

        .close-stats {
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 28px;
            cursor: pointer;
        }

        .stats-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            background: #333;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 5px;
        }

        .tab.active {
            background: #4CAF50;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chart-bar {
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin: 15px 0;
            position: relative;
        }

        .chart-bar::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: #4CAF50;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏... */
    </style>
</head>
<body>
    <!-- –ú–µ–Ω—é -->
    <div class="menu-btn">‚ò∞</div>
    <div class="sidebar" id="sidebar">
        <div class="menu-header">
            <h3>–ú–µ–Ω—é WebApp</h3>
            <span class="close-btn">√ó</span>
        </div>
        <ul class="menu-items">
            <li><a href="https://t.me/Tasbih_rubot?start=m1">üì± –ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="https://t.me/inut_islam">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
            <li><a href="#profile">ü™™ –ü—Ä–æ—Ñ–∏–ª—å</a></li>
            <li><a href="#stats" class="stats-link">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a></li>
            <li><a href="#qr">‚ùî –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç üéÅ</a></li>
            <li><a href="#help">üÜò –ü–æ–º–æ—â—å</a></li>
            <li><a href="#" onclick="resetTotalCount()">üö´ –°–±—Ä–æ—Å–∏—Ç—å –æ–±—â–∏–π —Å—á—ë—Ç</a></li>
        </ul>
    </div>
    <div class="overlay" id="overlay"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="stats-modal" class="stats-modal">
        <div class="stats-content">
            <span class="close-stats">&times;</span>
            <div class="stats-tabs">
                <button class="tab active" data-tab="daily">–î–µ–Ω—å</button>
                <button class="tab" data-tab="weekly">–ù–µ–¥–µ–ª—è</button>
                <button class="tab" data-tab="total">–í—Å–µ –≤—Ä–µ–º—è</button>
            </div>
            
            <div id="daily-stats" class="tab-content active">
                <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="chart-bar"></div>
                <p>–°–µ–≥–æ–¥–Ω—è: <span id="today-count">0</span></p>
            </div>

            <div id="weekly-stats" class="tab-content">
                <h3>–ù–µ–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="chart-bar weekly-chart"></div>
                <p>–ó–∞ –Ω–µ–¥–µ–ª—é: <span id="week-count">0</span></p>
            </div>

            <div id="total-stats" class="tab-content">
                <h3>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="chart-bar total-chart"></div>
                <p>–í—Å–µ–≥–æ: <span id="total-stats-count">0</span></p>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <a href="https://t.me/Tasbih_ru" class="top-link" target="_blank">‚ò™Ô∏è Tasbih Reward</a>

    <div class="level-container">
        <div class="level-bar">
            <div class="level-progress"></div>
            <div class="level-text">–£—Ä–æ–≤–µ–Ω—å <span id="level">1</span> –∏–∑ 5</div>
        </div>
    </div>

    <div class="main-progress-container">
        <div class="main-progress-bar">
            <div class="main-progress"></div>
            <div class="main-counter"><span id="count">0</span>/33</div>
        </div>
    </div>

    <div class="zikr-container">
        <div class="zikr-button">
            üìø
            <div class="zikr-text" id="zikr-text">–°—É–±—Ö–∞–Ω–∞–ª–ª–∞—Ö</div>
        </div>
    </div>

    <div class="reset-container">
        <button id="reset">‚≠ï</button>
    </div>

    <div class="counters-container">
        <div class="daily-counter">
            –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å—á—ë—Ç: <span id="daily-count">0</span>
        </div>
        <div class="total-counter">
            –û–±—â–∏–π —Å—á—ë—Ç: <span id="total-count">0</span>
        </div>
    </div>

    <script>
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        const SETTINGS = {
            zikrList: [
                "–°—É–±h–∞–Ω–∞–ª–õ–æh",
                "–ê–ªh–∞–º–¥—É–ª–∏–ª–õah",
                "–ê–ª–ª–æh—É –ê–∫–±–∞—Ä",
                "–õ–∞ –∏–ª–êh–∞ –∏–ª–ª–∞–ª–õ–æh", 
                "–ê—Å—Ç–∞–≥—Ñ–∏—Ä—É–ª–õoh", 
                "–°—É–±h–∞–Ω–∞–ª–õ–æh–∏ –≤–∞ –±–∞h–∞–º–¥–∏h–∏h–∏", 
                "–õ–∞ –∏–ª–∞ha –∏–ª–ª–∞-–ª–õ–æh—É –≤–∞h–¥–∞h—É –ª–∞ —à–∞—Ä–∏–∫–∞ –ª–∞h. –õ–∞h—É–ª –º—É–ª–∫—É –≤–∞ –ª–∞h—É-–ª ha–º–¥–∞ –≤–∞ h—É–≤–∞ —ä–∞–ª–∞ –∫—É–ª–ª–∏ —à–∞–π–∏–Ω Q–∞–¥–∏—Ä" 
            ],
            levels: [
                {required: 3500, level: 1},
                {required: 7000, level: 2},
                {required: 14000, level: 3},
                {required: 30000, level: 4},
                {required: 50000, level: 5}
            ]
        };

        let appData = JSON.parse(localStorage.getItem('tasbihData')) || {
            count: 0,
            totalCount: 0,
            dailyCount: 0,
            currentZikrIndex: 0,
            lastUpdate: new Date().toISOString().split('T')[0],
            history: []
        };

        const tg = window.Telegram.WebApp;

        // –§—É–Ω–∫—Ü–∏–∏ –º–µ–Ω—é
        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        document.querySelector('.menu-btn').addEventListener('click', toggleMenu);
        document.querySelector('.close-btn').addEventListener('click', toggleMenu);
        document.getElementById('overlay').addEventListener('click', toggleMenu);

        // –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
        function saveData() {
            localStorage.setItem('tasbihData', JSON.stringify(appData));
            if(tg?.sendData) {
                tg.sendData(JSON.stringify(appData));
            }
        }

        function updateDisplays() {
            const today = new Date().toISOString().split('T')[0];
            if(appData.lastUpdate !== today) {
                appData.dailyCount = 0;
                appData.lastUpdate = today;
                saveData();
            }

            document.getElementById('count').textContent = appData.count;
            document.getElementById('total-count').textContent = appData.totalCount;
            document.getElementById('daily-count').textContent = appData.dailyCount;
            document.getElementById('zikr-text').textContent = 
                SETTINGS.zikrList[appData.currentZikrIndex];
            
            document.querySelector('.main-progress').style.width = 
                `${(appData.count/33)*100}%`;
            document.querySelector('.level-progress').style.width = 
                `${calculateLevelProgress()}%`;
        }

        function calculateLevelProgress() {
            const currentLevel = SETTINGS.levels.find(l => appData.totalCount < l.required) || {level: 5};
            document.getElementById('level').textContent = currentLevel.level;
            const prevLevel = SETTINGS.levels[currentLevel.level-2] || {required: 0};
            return ((appData.totalCount - prevLevel.required)/(currentLevel.required - prevLevel.required))*100 || 100;
        }

        document.addEventListener('click', (e) => {
            if(!e.target.closest('#reset') && !e.target.closest('.menu-btn')) {
                if(document.getElementById('sidebar').classList.contains('active')) {
                    toggleMenu();
                }
                
                appData.count++;
                appData.totalCount++;
                appData.dailyCount++;
                
                if(appData.count === 33) {
                    appData.count = 0;
                    appData.currentZikrIndex = (appData.currentZikrIndex + 1) % SETTINGS.zikrList.length;
                }
                
                updateDisplays();
                saveData();
            }
        });

        document.getElementById('reset').addEventListener('click', () => {
            appData.count = 0;
            appData.currentZikrIndex = 0;
            updateDisplays();
            saveData();
        });

        // –§—É–Ω–∫—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function showStatsModal() {
            document.getElementById('stats-modal').style.display = 'block';
            updateStats();
        }

        function hideStatsModal() {
            document.getElementById('stats-modal').style.display = 'none';
        }

        function updateStats() {
            const todayData = appData.history.find(item => item.date === new Date().toISOString().split('T')[0]);
            document.getElementById('today-count').textContent = todayData ? todayData.count : 0;
            
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekData = appData.history.filter(item => 
                new Date(item.date) >= weekAgo
            );
            const weekTotal = weekData.reduce((sum, item) => sum + item.count, 0);
            document.getElementById('week-count').textContent = weekTotal;
            
            document.getElementById('total-stats-count').textContent = appData.totalCount;
            updateCharts();
        }

        function updateCharts() {
            const dailyBars = document.querySelectorAll('.chart-bar');
            dailyBars.forEach(bar => {
                const percent = (appData.dailyCount / 33) * 100;
                bar.style.setProperty('--width', `${percent}%`);
            });
        }

        document.querySelector('.stats-link').addEventListener('click', function(e) {
            e.preventDefault();
            showStatsModal();
        });

        document.querySelector('.close-stats').addEventListener('click', hideStatsModal);
        document.getElementById('stats-modal').addEventListener('click', function(e) {
            if(e.target === this) hideStatsModal();
        });

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                    if(content.id === `${this.dataset.tab}-stats`) {
                        content.classList.add('active');
                    }
                });
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.ready();
        tg.expand();
        updateDisplays();
    </script>
</body>
</html>